import{C as p,r as m}from"./chart-BOVB5OMx.js";import{p as w,A as _,_ as S,c as d,a as t,t as i,f as h,b as g,n as y,e as C,o as u}from"./index-t9xi5tuB.js";p.register(...m);const v=w.create({baseURL:_,withCredentials:!0,headers:{"Content-Type":"application/json"}});v.interceptors.response.use(s=>s,s=>(s.response&&s.response.status===401&&(window.location.href="/login"),Promise.reject(s)));const x={async getUniversitiesOverview(){try{return(await v.get("/api/analytics/universities")).data}catch(s){throw console.error("Error fetching universities analytics:",s),s}},async getDegreeDetails(s,e){try{return(await v.get("/api/analytics/university/degree",{params:{university:s,degree:e}})).data}catch(r){throw console.error("Error fetching degree analytics:",r),r}},async getModuleDetails(s){try{return(await v.get("/api/analytics/module",{params:{module_id:s}})).data}catch(e){throw console.error("Error fetching module analytics:",e),e}},async updateModuleAnalytics(s){try{return(await v.post("/api/analytics/update-module",s)).data}catch(e){throw console.error("Error updating module analytics:",e),e}}},D={name:"ModuleAnalyticsComponent",props:{moduleId:{type:String,required:!0},yourScore:{type:Number,default:null}},data(){return{loading:!0,error:null,analytics:{studentCount:0,averageScore:0,medianScore:0,highestScore:0,lowestScore:0,standardDeviation:0,passRate:0,firstClassRate:0,lastUpdated:new Date,year:"",gradeDistribution:[]},chart:null}},async mounted(){await this.fetchAnalytics(),setTimeout(()=>{this.renderGradeDistributionChart()},100)},beforeDestroy(){this.chart&&this.chart.destroy()},methods:{async fetchAnalytics(){this.loading=!0,this.error=null;try{const s=await x.getModuleDetails(this.moduleId);this.analytics={studentCount:s.studentCount||0,averageScore:s.averageScore||0,medianScore:s.medianScore||0,highestScore:s.highestScore||0,lowestScore:s.lowestScore||0,standardDeviation:s.standardDeviation||0,passRate:s.passRate||0,firstClassRate:s.firstClassRate||0,lastUpdated:new Date(s.lastUpdated||Date.now()),year:s.year||"",gradeDistribution:s.gradeDistribution||[]},this.$nextTick(()=>{this.renderGradeDistributionChart()})}catch(s){console.error("Error fetching module analytics:",s),this.error="Failed to load analytics data. Please try again later."}finally{this.loading=!1}},renderGradeDistributionChart(){if(!this.$refs.gradeDistributionChart){console.warn("Chart canvas element not found, deferring chart rendering"),this.$nextTick(()=>{setTimeout(()=>this.renderGradeDistributionChart(),50)});return}this.chart&&(this.chart.destroy(),this.chart=null);const s=this.$refs.gradeDistributionChart.getContext("2d");if(!s){console.warn("Canvas context not available, deferring chart rendering"),setTimeout(()=>this.renderGradeDistributionChart(),100);return}const e=this.analytics.gradeDistribution.length>0?this.analytics.gradeDistribution:[{range:"0-10%",count:0},{range:"11-20%",count:0},{range:"21-30%",count:0},{range:"31-40%",count:0},{range:"41-50%",count:0},{range:"51-60%",count:0},{range:"61-70%",count:0},{range:"71-80%",count:0},{range:"81-90%",count:0},{range:"91-100%",count:0}],r=document.body.classList.contains("dark-mode"),n={labels:e.map(o=>o.range),datasets:[{label:"Number of Students",data:e.map(o=>o.count),backgroundColor:e.map((o,l)=>`hsla(${l*12}, 80%, 60%, 0.7)`),borderColor:e.map((o,l)=>`hsla(${l*12}, 80%, 50%, 1)`),borderWidth:1,borderRadius:4}]},a={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(o){return o[0].label},label:function(o){return`${o.parsed.y} students`}}}},scales:{y:{beginAtZero:!0,grid:{color:r?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{precision:0,color:r?"#cbd5e1":"#333333"}},x:{grid:{display:!1},ticks:{color:r?"#cbd5e1":"#333333"}}}};if(this.yourScore!==null)try{const l=Math.min(Math.floor(this.yourScore/10),9);n.datasets.push({type:"line",label:"Your Score",data:Array(e.length).fill(null).map((c,f)=>f===l?Math.max(...e.map(b=>b.count))*1.1:null),borderColor:"#ff6b6b",borderWidth:2,pointBackgroundColor:"#ff6b6b",pointRadius:c=>c===l?6:0,pointHoverRadius:c=>c===l?8:0,tension:0})}catch(o){console.warn("Failed to add score marker to chart:",o)}try{this.chart=new p(s,{type:"bar",data:n,options:a})}catch(o){console.error("Error creating chart:",o)}},formatDate(s){const e={year:"numeric",month:"short",day:"numeric"};return new Date(s).toLocaleDateString(void 0,e)},getScoreClass(s){return s>=70?"excellent-score":s>=60?"good-score":s>=50?"average-score":s>=40?"pass-score":"fail-score"},getDifferenceClass(s){return s>=10?"diff-excellent":s>0?"diff-good":s>=-5?"diff-average":"diff-below"},calculatePercentile(s){if(!this.analytics||!this.analytics.gradeDistribution)return 0;let e=0,r=0;return this.analytics.gradeDistribution.forEach(n=>{const a=parseInt(n.range.split("-")[1]);e+=n.count,s>a?r+=n.count:s>=parseInt(n.range.split("-")[0])&&(r+=n.count/2)}),e>0?Math.round(r/e*100):0}}},k={class:"module-analytics"},M={key:0,class:"loading-indicator"},R={key:1,class:"error-message"},A={key:2,class:"analytics-content"},B={class:"analytics-summary"},E={class:"summary-card student-count"},P={class:"card-content"},U={class:"card-value"},j={class:"summary-card average-score"},I={class:"card-content"},L={class:"card-value"},T={class:"summary-card median-score"},G={class:"card-content"},N={class:"card-value"},F={class:"summary-card updated"},V={class:"card-content"},Y={class:"card-value"},z={class:"chart-section"},H={class:"chart-container"},O={ref:"gradeDistributionChart"},W={key:0,class:"your-score-section"},q={class:"score-comparison"},Z={class:"score-value"},J={class:"diff-value"},K={key:0},Q={class:"percentile"},X={class:"percentile-value"},$={class:"stats-section"},tt={class:"stats-grid"},et={class:"stat-item"},st={class:"stat-value"},at={class:"stat-item"},rt={class:"stat-value"},ot={class:"stat-item"},it={class:"stat-value"},nt={class:"stat-item"},lt={class:"stat-value"},ct={class:"stat-item"},dt={class:"stat-value"},ut={class:"stat-item"},vt={class:"stat-value"};function ht(s,e,r,n,a,o){return u(),d("div",k,[a.loading?(u(),d("div",M,e[0]||(e[0]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading analytics data...",-1)]))):a.error?(u(),d("div",R,[e[1]||(e[1]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1)),t("p",null,i(a.error),1)])):(u(),d("div",A,[t("div",B,[t("div",E,[e[3]||(e[3]=g('<div class="card-icon" data-v-0e9ab91c><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-0e9ab91c><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" data-v-0e9ab91c></path><circle cx="9" cy="7" r="4" data-v-0e9ab91c></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87" data-v-0e9ab91c></path><path d="M16 3.13a4 4 0 0 1 0 7.75" data-v-0e9ab91c></path></svg></div>',1)),t("div",P,[t("div",U,i(a.analytics.studentCount),1),e[2]||(e[2]=t("div",{class:"card-label"},"Students",-1))])]),t("div",j,[e[5]||(e[5]=t("div",{class:"card-icon"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),t("polyline",{points:"22 4 12 14.01 9 11.01"})])],-1)),t("div",I,[t("div",L,i(a.analytics.averageScore)+"%",1),e[4]||(e[4]=t("div",{class:"card-label"},"Average Score",-1))])]),t("div",T,[e[7]||(e[7]=g('<div class="card-icon" data-v-0e9ab91c><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-0e9ab91c><line x1="18" y1="20" x2="18" y2="10" data-v-0e9ab91c></line><line x1="12" y1="20" x2="12" y2="4" data-v-0e9ab91c></line><line x1="6" y1="20" x2="6" y2="14" data-v-0e9ab91c></line></svg></div>',1)),t("div",G,[t("div",N,i(a.analytics.medianScore)+"%",1),e[6]||(e[6]=t("div",{class:"card-label"},"Median Score",-1))])]),t("div",F,[e[9]||(e[9]=t("div",{class:"card-icon"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("polyline",{points:"12 6 12 12 16 14"})])],-1)),t("div",V,[t("div",Y,i(o.formatDate(a.analytics.lastUpdated)),1),e[8]||(e[8]=t("div",{class:"card-label"},"Last Updated",-1))])])]),t("div",z,[e[10]||(e[10]=t("h3",null,"Grade Distribution",-1)),t("div",H,[t("canvas",O,null,512)])]),r.yourScore!==null?(u(),d("div",W,[e[14]||(e[14]=t("h3",null,"Your Performance",-1)),t("div",q,[t("div",{class:y(["your-score",o.getScoreClass(r.yourScore)])},[t("div",Z,i(r.yourScore)+"%",1),e[11]||(e[11]=t("div",{class:"score-label"},"Your Score",-1))],2),t("div",{class:y(["score-difference",o.getDifferenceClass(r.yourScore-a.analytics.averageScore)])},[t("div",J,[r.yourScore>=a.analytics.averageScore?(u(),d("span",K,"+")):h("",!0),C(i((r.yourScore-a.analytics.averageScore).toFixed(1))+"% ",1)]),e[12]||(e[12]=t("div",{class:"diff-label"},"Compared to Average",-1))],2),t("div",Q,[t("div",X,i(o.calculatePercentile(r.yourScore))+"%",1),e[13]||(e[13]=t("div",{class:"percentile-label"},"Percentile",-1))])])])):h("",!0),t("div",$,[e[21]||(e[21]=t("h3",null,"Detailed Statistics",-1)),t("div",tt,[t("div",et,[e[15]||(e[15]=t("div",{class:"stat-label"},"Highest Score",-1)),t("div",st,i(a.analytics.highestScore)+"%",1)]),t("div",at,[e[16]||(e[16]=t("div",{class:"stat-label"},"Lowest Score",-1)),t("div",rt,i(a.analytics.lowestScore)+"%",1)]),t("div",ot,[e[17]||(e[17]=t("div",{class:"stat-label"},"Standard Deviation",-1)),t("div",it,i(a.analytics.standardDeviation.toFixed(1)),1)]),t("div",nt,[e[18]||(e[18]=t("div",{class:"stat-label"},"Pass Rate",-1)),t("div",lt,i(a.analytics.passRate)+"%",1)]),t("div",ct,[e[19]||(e[19]=t("div",{class:"stat-label"},"First Class Rate",-1)),t("div",dt,i(a.analytics.firstClassRate)+"%",1)]),t("div",ut,[e[20]||(e[20]=t("div",{class:"stat-label"},"Year",-1)),t("div",vt,i(a.analytics.year),1)])])])]))])}const pt=S(D,[["render",ht],["__scopeId","data-v-0e9ab91c"]]);export{pt as M};
